name: Mindful News Pipeline

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  run_pipeline:
    runs-on: ubuntu-latest
    env:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
    steps:

    # Checkout the code
    - name: Checkout repository
      uses: actions/checkout@v2

    # Set up Python environment
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.10'

    # Install dependencies
    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    # Run main.py to generate RSS
    - name: Run main.py to generate mindfulnews.xml
      run: python main.py

    # Validate RSS generated by main.py
    - name: Validate RSS (main output)
      run: python validate_rss.py mindfulnews.xml

    # Run editorial_filter.py to filter the news
    - name: Run editorial_filter.py
      run: python editorial_filter.py

    # Validate the filtered RSS
    - name: Validate RSS (filtered output)
      run: python validate_rss.py mindfulnews_filtered.xml

    # Upload the filtered RSS as an artifact
    - name: Upload filtered RSS as artifact
      uses: actions/upload-artifact@v4
      with:
        name: mindfulnews_filtered
        path: mindfulnews_filtered.xml

    # Final message
    - name: Notify success
      run: echo "Mindful News pipeline completed successfully!"